<!-- huse_personalizate.html -->
{% extends "base.html" %}

{% block title %}
<title>{{ t('cases.meta.title') }}</title>
{% endblock %}

{% block meta %}
<meta name="description" content="{{ t('cases.meta.description') }}" />
<meta name="keywords" content="{{ t('cases.meta.keywords') }}" />
{% endblock %}

{% block header_subtitle %}{{ t('cases.header.subtitle') }}{% endblock %}

{% block main %}
<main class="flex-grow max-w-7xl mx-auto px-6 py-10 w-full">
  <div class="flex flex-col lg:flex-row gap-8">

    <!-- Левая панель -->
    <aside class="glass neumorphic rounded-3xl p-6 flex flex-col gap-6 lg:w-96">

  <!-- TITLE -->
  <div class="space-y-3">
    <h2 class="text-lg font-semibold text-gray-800 dark:text-gray-100">
      {{ t('cases.left.title') }}
    </h2>

    <!-- BRAND + MODEL in one row -->
    <div class="grid grid-cols-2 gap-3">
      <div class="relative">
        <select
          id="brand-select"
          class="w-full appearance-none bg-white/70 dark:bg-gray-900/60 backdrop-blur-md
                 border border-gray-200 dark:border-white/10 rounded-2xl
                 px-4 py-3 text-sm md:text-base
                 text-gray-800 dark:text-gray-100
                 focus:outline-none focus:ring-4 focus:ring-accent/30 focus:border-accent
                 transition-all duration-300 cursor-pointer"
        >
          <option value="">{{ t('cases.select.brand.placeholder') }}</option>
          <option value="apple">{{ t('cases.brand.apple') }}</option>
          <option value="samsungs">{{ t('cases.brand.samsung_s') }}</option>
          <option value="samsunga">{{ t('cases.brand.samsung_a') }}</option>
          <option value="samsungm">{{ t('cases.brand.samsung_m') }}</option>
          <option value="redmi">{{ t('cases.brand.redmi') }}</option>
          <option value="oppo">{{ t('cases.brand.oppo') }}</option>
          <option value="poco">{{ t('cases.brand.poco') }}</option>
        </select>
        <div class="absolute inset-y-0 right-4 flex items-center pointer-events-none">
          <i class="fas fa-chevron-down text-gray-400 text-sm"></i>
        </div>
      </div>

      <div class="relative">
        <select
          id="model-select"
          class="w-full appearance-none bg-white/70 dark:bg-gray-900/60 backdrop-blur-md
                 border border-gray-200 dark:border-white/10 rounded-2xl
                 px-4 py-3 text-sm md:text-base
                 text-gray-800 dark:text-gray-100
                 focus:outline-none focus:ring-4 focus:ring-accent/30 focus:border-accent
                 transition-all duration-300 cursor-pointer"
        >
          <option value="">{{ t('cases.select.model.placeholder') }}</option>
        </select>
        <div class="absolute inset-y-0 right-4 flex items-center pointer-events-none">
          <i class="fas fa-chevron-down text-gray-400 text-sm"></i>
        </div>
      </div>
    </div>
  </div>

  <!-- UPLOAD: drag&drop zone (visual only for now) -->
  <input type="file" id="upload" multiple accept="image/*" class="hidden"/>

  <label
    for="upload"
    id="upload-dropzone"
    class="group glass rounded-3xl border border-dashed border-gray-400 dark:border-white/15
            bg-white/60 dark:bg-gray-900/40
           p-5 cursor-pointer select-none
           hover:bg-white/90 dark:hover:bg-gray-900/70
            hover:border-accent/60
           transition-all duration-300"
  >
    <div class="flex items-center gap-4">
      <div class="w-12 h-12 rounded-2xl flex items-center justify-center
                  bg-white/80 dark:bg-gray-950/40 border border-gray-200 dark:border-white/10">
        <i class="fas fa-cloud-upload-alt text-accent text-lg"></i>
      </div>

      <div class="flex-1">
        <div class="font-semibold text-gray-800 dark:text-gray-100 leading-tight">
          {{ t('cases.upload') }}
        </div>
<!--        <div class="text-xs text-gray-500 dark:text-gray-400 mt-1">-->
<!--          Drag & drop sau click-->
<!--        </div>-->
      </div>
    </div>
  </label>

  <!-- THUMBNAILS -->
  <div id="thumbnails-container" class="max-h-96 overflow-y-auto pr-1">
    <div id="thumbnails" class="grid grid-cols-3 gap-3"></div>
  </div>

  <!-- ADD TEXT -->
 <!-- TEXT ADD (inline) -->
<div class="glass rounded-3xl p-4 border border-gray-200/70 dark:border-white/10">
  <div class="flex items-start gap-3">
    <!-- input -->
    <div class="flex-1">
      <label class="block text-[10px] font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2">
        {{ t('cases.text.title') }}
      </label>

      <input
        id="text-input"
        type="text"
        placeholder="{{ t('cases.text.placeholder') }}"
        class="w-full bg-white/80 dark:bg-gray-900/60
               border border-gray-200 dark:border-white/10
               rounded-2xl px-4 py-3 text-sm md:text-base
               text-gray-900 dark:text-gray-100
               placeholder-gray-400 dark:placeholder-gray-500
               focus:outline-none focus:ring-4 focus:ring-accent/30 focus:border-accent
               transition"
      />
    </div>

    <!-- tools -->

  </div>

  <!-- compact controls row -->
  <div class="mt-3 flex items-center gap-3">
    <select
      id="font-selector"
      class="flex-1 bg-white/80 dark:bg-gray-900/60
             border border-gray-200 dark:border-white/10
             rounded-2xl px-3 py-2 text-sm
             text-gray-900 dark:text-gray-100"
    >
      <option value="Poppins, sans-serif">{{ t('cases.text.font.poppins') }}</option>
      <option value="Arial">{{ t('cases.text.font.arial') }}</option>
      <option value="Courier New">{{ t('cases.text.font.courier') }}</option>
      <option value="Pacifico, cursive">{{ t('cases.text.font.pacifico') }}</option>
    </select>

    <div class="relative w-12 h-12">
      <input
        id="color-picker"
        type="color"
        value="#000000"
        class="absolute inset-0 w-full h-full cursor-pointer
               rounded-full border-0 p-0
               appearance-none bg-transparent"
      />
    </div>


  </div>
</div>
<button
      id="add-text"
      type="button"
      class="bg-accent text-white px-4 py-3 rounded-2xl font-semibold
             hover:opacity-95 transition flex items-center gap-2 transition flex items-center justify-center gap-2"
    >
      <i class="fas fa-plus-circle"></i>
      {{ t('cases.text.add') }}
    </button>

  <!-- CLEAR (red) -->
     <button
      id="clear-canvas"
      data-action="clear"
      type="button"
      class="w-full py-3 rounded-2xl font-semibold
             bg-red-600 text-white
             hover:bg-red-700 active:bg-red-800
             transition flex items-center justify-center gap-2
             shadow-lg shadow-red-600/20"
    >
      <i class="fas fa-trash"></i>{{ t('cases.actions.clear_all') }}
    </button>

</aside>


    <!-- Центральный canvas -->
    <!-- Центральный canvas -->
<section class="flex-1 flex flex-col items-center gap-6">
  <div class="glass neumorphic rounded-3xl p-4 sm:p-8 md:p-10 shadow-2xl max-w-full overflow-hidden">
    <!-- ВАЖНО: relative -->
    <div id="canvas-wrap" class="relative w-full h-full">

      <div id="canvas-container-source" class="w-full h-full flex justify-center items-center">
        <canvas
          id="phone-canvas"
          width="360"
          height="670"
          class="rounded-3xl shadow-2xl border border-gray-200 dark:border-white/10 block"
          style="max-width: 100%; height: auto;"></canvas>
      </div>

      <!-- SCALE OVERLAY (на самом канвасе) -->
      <div
        id="scale-panel"
        class="hidden absolute left-1/2 -translate-x-1/2 bottom-3 z-50
               w-[85%] max-w-[420px]
               px-3 py-2 rounded-2xl
               bg-white/60 dark:bg-black/40
               backdrop-blur-md shadow-lg
               pointer-events-auto"
      >
        <input
          id="scale-slider"
          type="range"
          min="1"
          max="300"
          value="100"
          step="1"
          class="w-full"
        />
      </div>

    </div>
  </div>
</section>


    <!-- Правая панель цены -->
    <aside class="glass neumorphic rounded-3xl p-8 lg:w-80">
      <div class="text-center py-8 border-b border-gray-200 dark:border-white/10">
        <p class="text-sm uppercase tracking-wider text-gray-500 dark:text-gray-400 mb-2">{{ t('cases.price.label') }}</p>
        <div class="text-6xl font-bold text-accent">
          {{ t('cases.price.value') }}
          <span class="text-3xl text-gray-600 dark:text-gray-300">{{ t('cases.price.currency') }}</span>
        </div>
      </div>

      <button id="order-btn" class="w-full bg-accent text-white py-6 rounded-2xl mt-8 font-bold text-xl hover:bg-indigo-700 transition shadow-lg">
        {{ t('btn.order') }} {{ t('cases.order.now') }} →
      </button>

      <p class="text-center text-sm text-gray-500 dark:text-gray-400 mt-4">
        <i class="fas fa-lock mr-1"></i>{{ t('cases.order.no_prepay') }}
      </p>

      <div class="grid grid-cols-2 gap-4 mt-8">
        <div class="bg-white/60 dark:bg-gray-900/60 border border-transparent dark:border-white/10 rounded-xl p-4 text-center">
          <i class="fas fa-shipping-fast text-2xl text-blue-500 mb-2"></i>
          <p class="text-xs font-bold text-gray-800 dark:text-gray-100">{{ t('cases.benefit.delivery') }}</p>
        </div>
        <div class="bg-white/60 dark:bg-gray-900/60 border border-transparent dark:border-white/10 rounded-xl p-4 text-center">
          <i class="fas fa-store text-2xl text-green-500 mb-2"></i>
          <p class="text-xs font-bold text-gray-800 dark:text-gray-100">{{ t('cases.benefit.pickup') }}</p>
        </div>
        <div class="bg-white/60 dark:bg-gray-900/60 border border-transparent dark:border-white/10 rounded-xl p-4 text-center">
          <i class="fas fa-gem text-2xl text-purple-500 mb-2"></i>
          <p class="text-xs font-bold text-gray-800 dark:text-gray-100">{{ t('cases.benefit.material') }}</p>
        </div>
        <div class="bg-white/60 dark:bg-gray-900/60 border border-transparent dark:border-white/10 rounded-xl p-4 text-center">
          <i class="fas fa-paint-brush text-2xl text-orange-500 mb-2"></i>
          <p class="text-xs font-bold text-gray-800 dark:text-gray-100">{{ t('cases.benefit.print') }}</p>
        </div>
      </div>
    </aside>

  </div>
</main>
{% endblock %}

{% block mobile_bar %}
<div class="fixed bottom-0 left-0 right-0 bg-white/95 dark:bg-gray-900/90 backdrop-blur-lg border-t border-gray-200 dark:border-white/10 p-4 flex gap-4 lg:hidden z-50 shadow-2xl">
  <button data-action="clear" class="flex-1 neumorphic-btn py-4 rounded-2xl font-medium">{{ t('cases.mobile.clear') }}</button>
  <button data-action="save" class="flex-1 bg-accent text-white py-4 rounded-2xl font-medium">{{ t('cases.mobile.save') }}</button>
  <button data-action="order" class="flex-1 bg-accent text-white py-4 rounded-2xl font-medium">{{ t('btn.order') }}</button>
</div>
{% endblock %}

{% block scripts %}
<script type="module" src="{{ request.url_for('static', path='js/main.js') }}"></script>
<script>
  fbq('track', 'ViewContent', {
    content_category: 'custom_case'
  });
</script>

<script>
document.addEventListener('DOMContentLoaded', function () {
  const btn = document.getElementById('order-btn');
  if (!btn) return;

  btn.addEventListener('click', function () {
    if (typeof fbq === 'function') {
      fbq('track', 'InitiateCheckout');
    }
  });
});
</script>
{% endblock %}

{% block footer_subtitle %}{{ t('cases.footer.subtitle') | safe }}{% endblock %}
